<section id="project-form" class="section-sm py-16 bg-gray-50 dark:bg-gray-900">
  <div class="container" data-aos="fade-up">
    <div class="text-center mb-12">
      <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-4">Project Proposal Form</h2>
      <p class="text-xl text-gray-600 dark:text-gray-300">Submit your project proposal to collaborate with IEEE UA Student Branch</p>
    </div>

    <!-- Success Popup (initially hidden) - Transparent background version -->
    <div id="success-popup" class="fixed inset-0 flex items-center justify-center z-50 hidden">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-8 max-w-md mx-4 border-2 border-blue-200 dark:border-blue-800">
        <div class="text-center">
          <div class="w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
          </div>
          <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">Thank You!</h3>
          <p class="text-gray-600 dark:text-gray-300 mb-6">Your proposal has been submitted successfully. We'll be in touch soon.</p>
          <button id="close-popup" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition duration-200">
            Close
          </button>
        </div>
      </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 md:p-12 max-w-4xl mx-auto">
      <!-- Remove the action attribute and add an ID -->
      <form id="project-proposal-form" method="POST">
        <!-- FormSubmit Configuration -->
        <input type="hidden" name="_subject" value="Nova Proposta de Projeto Submetida - IEEE UA SB">
        <input type="hidden" name="_template" value="table">
        <!-- Remove the _next parameter since we're handling with JS -->
        <input type="text" name="_honey" style="display:none">
        <input type="hidden" name="_captcha" value="false">

        <!-- Company Information Section -->
        <div class="mb-8 pb-6 border-b border-gray-200 dark:border-gray-700">
          <h3 class="text-xl font-semibold text-blue-800 dark:text-blue-500 mb-6">Company Information</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="empresa" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Empresa <span class="text-red-500">*</span></label>
              <input type="text" id="empresa" name="empresa" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
            </div>
            <div>
              <label for="contacto" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Contacto da Empresa <span class="text-red-500">*</span></label>
              <input type="text" id="contacto" name="contacto" placeholder="Email ou telefone" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
            </div>
          </div>
        </div>

        <!-- Project Details Section -->
        <div class="mb-8 pb-6 border-b border-gray-200 dark:border-gray-700">
          <h3 class="text-xl font-semibold text-blue-800 dark:text-blue-500 mb-6">Project Details</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
              <label for="nome_projeto" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Nome do Projeto <span class="text-red-500">*</span></label>
              <input type="text" id="nome_projeto" name="nome_projeto" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required>
            </div>
            <div>
              <label for="numero_pessoas" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Número de Pessoas Necessárias</label>
              <input type="number" class="[appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none">
            </div>
          </div>
          
          <div class="mb-6">
            <label for="descricao" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Descrição Resumida do Projeto <span class="text-red-500">*</span></label>
            <textarea id="descricao" name="descricao" rows="3" placeholder="2–3 linhas para contexto" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white" required></textarea>
          </div>
          
          <div>
            <label for="conceitos_tecnicos" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Conceitos Técnicos a serem Aplicados</label>
            <textarea id="conceitos_tecnicos" name="conceitos_tecnicos" rows="2" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></textarea>
          </div>
        </div>

        <!-- Collaboration Details Section -->
        <div class="mb-8">
          <h3 class="text-xl font-semibold text-blue-800 dark:text-blue-500 mb-6">Collaboration Details</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="duracao" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Duração Estimada</label>
              <input type="text" id="duracao" name="duracao" placeholder="ex: 3 meses; Jan 2025 - Mar 2025" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
            </div>
            <div>
              <label for="local" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Local da Colaboração</label>
              <select id="local" name="local" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                <option value="" selected disabled>Selecione uma opção</option>
                <option value="Remoto">Remoto</option>
                <option value="Presencial">Presencial</option>
                <option value="Híbrido">Híbrido</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Additional Information -->
        <div class="mb-8">
          <label for="observacoes" class="block text-gray-700 dark:text-gray-300 font-medium mb-2">Observações Adicionais</label>
          <textarea id="observacoes" name="observacoes" rows="4" placeholder="Campo aberto para detalhes extra" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></textarea>
        </div>

        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 transform hover:scale-105">
          Enviar Proposta
        </button>
      </form>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('project-proposal-form');
  const popup = document.getElementById('success-popup');
  const closeButton = document.getElementById('close-popup');
  
  // Handle form submission
  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Show loading state on the submit button
    const submitButton = form.querySelector('button[type="submit"]');
    const originalText = submitButton.textContent;
    submitButton.textContent = 'Enviando...';
    submitButton.disabled = true;
    
    try {
      // Create FormData from the form
      const formData = new FormData(form);
      
      // Send the form data to FormSubmit
      const response = await fetch('https://formsubmit.co/franciscompereira@ua.pt', {
        method: 'POST',
        body: formData
      });
      
      if (response.ok) {
        // Show success popup
        popup.classList.remove('hidden');
        // Reset the form
        form.reset();
      } else {
        alert('There was an error submitting your form. Please try again.');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('There was an error submitting your form. Please try again.');
    } finally {
      // Restore the button state
      submitButton.textContent = originalText;
      submitButton.disabled = false;
    }
  });
  
  // Close the popup when the close button is clicked
  closeButton.addEventListener('click', function() {
    popup.classList.add('hidden');
  });
  
  // Close the popup when clicking outside of it
  document.addEventListener('click', function(e) {
    if (popup.contains(e.target) && e.target !== popup && !popup.querySelector('.bg-white').contains(e.target)) {
      popup.classList.add('hidden');
    }
  });
  
  // Close the popup when pressing the Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && !popup.classList.contains('hidden')) {
      popup.classList.add('hidden');
    }
  });
});
</script>